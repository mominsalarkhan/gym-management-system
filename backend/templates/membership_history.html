{% extends "base.html" %}

{% block content %}
  <div class="section">
    <div class="page-header">
      <h2>Membership History{% if member %} for {{ member.FirstName }} {{ member.LastName }}{% endif %}</h2>
      <a href="{{ url_for('members.add_membership_history', mid=member.MemberID) if member else url_for('members.add_membership_history') }}" class="add-btn">Add History</a>
    </div>

  
  {% if not member %}
  <a href="{{ url_for('members.list_members') }}" class="back-btn">Back to Members</a>
  {% endif %}

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <table class="table-container">
    <tr>
      <th>History ID</th>
      <th>Member</th>
      <th>Plan</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Actions</th>
    </tr>
    {% for record in history %}
    <tr>
      <td>{{ record.HistoryID }}</td>
      <td>{{ record.FirstName }} {{ record.LastName }}</td>
      <td>{{ record.PlanName }}</td>
      <td>{{ record.StartDate }}</td>
      <td>{{ record.EndDate or 'Ongoing' }}</td>
      <td>
        <div class="table-actions">
        <a href="{{ url_for('members.edit_membership_history', hid=record.HistoryID) }}" class="btn btn-secondary btn-sm">Edit</a>
        <form method="post" action="{{ url_for('members.delete_membership_history', hid=record.HistoryID) }}" style="display:inline;" onsubmit="return confirm('Delete this history entry?');">
          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
        </form>
        </div>
      </td>
    </tr>
    {% endfor %}
  </table>
{% endblock %}